# 动态网格交易策略 - 使用指南

## 📋 目录
- [简介](#简介)
- [什么是网格交易](#什么是网格交易)
- [功能特性](#功能特性)
- [快速开始](#快速开始)
- [配置说明](#配置说明)
- [策略逻辑](#策略逻辑)
- [风险提示](#风险提示)
- [常见问题](#常见问题)

## 简介

这是一个基于 Bumpin API 实现的自动化网格交易策略。该策略能够在预设的价格区间内自动执行买入和卖出操作，适合震荡行情和套利交易。

## 什么是网格交易

网格交易是一种量化交易策略，核心思想是：

1. **设定价格区间**：确定一个上限和下限价格
2. **划分网格**：在价格区间内均匀划分多个价格点
3. **低买高卖**：
   - 当价格下跌到某个网格价格时，自动买入
   - 当价格上涨到上一层网格时，自动卖出
4. **重复套利**：在震荡行情中反复获利

### 示例
假设设置：
- 价格区间：$60,000 - $70,000
- 网格数量：10个
- 每格投资：$100

网格将被划分为：
```
等级 10: $70,000 ⬆️ (上限)
等级 9:  $69,000
等级 8:  $68,000
等级 7:  $67,000
等级 6:  $66,000
等级 5:  $65,000
等级 4:  $64,000
等级 3:  $63,000
等级 2:  $62,000
等级 1:  $61,000
等级 0:  $60,000 ⬇️ (下限)
```

交易逻辑：
- 价格跌到 $65,000 → 买入 $100
- 价格涨到 $66,000 → 卖出，赚取差价
- 价格继续涨到 $67,000 → 如果有持仓则卖出
- 价格跌回 $66,000 → 买入 $100

## 功能特性

✅ **自动化交易**：无需手动下单，策略自动执行
✅ **动态网格**：支持自定义网格数量和价格区间
✅ **风险控制**：支持止损和止盈设置
✅ **实时监控**：实时显示网格状态和持仓情况
✅ **详细日志**：记录所有交易操作和盈亏情况
✅ **优雅退出**：安全停止策略，生成最终报告
✅ **多种配置**：提供保守、激进、中性三种预设配置

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 配置API密钥

编辑 `grid-strategy-example.js` 文件，填入你的API密钥：

```javascript
const API_KEY = 'your_api_key_here';
const SECRET_KEY = 'your_secret_key_here';
```

### 3. 调整策略参数

根据你的需求修改配置：

```javascript
const strategyConfig = {
    symbol: 'BTCUSD',        // 交易对
    marketIndex: 0,          // 市场索引
    gridLower: 60000,        // 网格下限
    gridUpper: 70000,        // 网格上限
    gridNumber: 10,          // 网格数量
    investmentPerGrid: 10,   // 每格投资金额
    leverage: 10,            // 杠杆倍数
    checkInterval: 10000,    // 检查间隔（毫秒）
};
```

### 4. 启动策略

```bash
node grid-strategy-example.js
```

### 5. 停止策略

按 `Ctrl + C` 优雅停止策略

## 配置说明

### 核心参数

| 参数 | 类型 | 说明 | 示例 |
|------|------|------|------|
| `apiKey` | String | Bumpin API密钥 | 'api_xxx...' |
| `secretKey` | String | Bumpin 密钥 | 'xxx...' |
| `symbol` | String | 交易对符号 | 'BTCUSD' |
| `marketIndex` | Number | 市场索引 | 0 |

### 网格参数

| 参数 | 类型 | 说明 | 建议 |
|------|------|------|------|
| `gridLower` | Number | 网格下限价格 | 当前价格的 -10% |
| `gridUpper` | Number | 网格上限价格 | 当前价格的 +10% |
| `gridNumber` | Number | 网格数量 | 5-20个 |
| `investmentPerGrid` | Number | 每格投资金额 | 总资金的 1-5% |

### 杠杆和风险

| 参数 | 类型 | 说明 | 建议 |
|------|------|------|------|
| `leverage` | Number | 杠杆倍数 | 5-20x |
| `stopLossPercent` | Number | 止损百分比 | 0.05 (5%) |
| `takeProfitRate` | Number | 止盈率 | 1 |
| `maxPositionSize` | Number | 最大持仓大小 | 按需设置 |

### 运行参数

| 参数 | 类型 | 说明 | 建议 |
|------|------|------|------|
| `checkInterval` | Number | 价格检查间隔（毫秒） | 5000-30000 |

## 策略逻辑

### 买入条件
1. 当前价格 ≤ 某个网格价格
2. 该网格没有持仓
3. 上方网格有持仓（或是最低网格）

### 卖出条件
1. 当前价格 ≥ 某个网格价格
2. 该网格有持仓
3. 价格已涨至下一个网格

### 网格状态

策略运行时会实时显示：

```
📊 网格状态:
   等级 0: 🟢 持仓 $60000.00 | 入场: $60100.00 | 数量: 0.001661
   等级 1: ⚪ 空闲 $61000.00
   等级 2: 🟢 持仓 $62000.00 | 入场: $61900.00 | 数量: 0.001616
   ...

📈 活跃持仓: 5
💰 已投资金额: $500.00
💵 累计盈利: $12.45
⏰ 下次检查: 10:30:45
```

## 预设配置

### 保守型配置
适合新手或小资金交易者：
- 窄价格区间（±3%）
- 较少网格（5个）
- 较小投资（$5/格）
- 较低杠杆（5x）
- 较长检查间隔（30秒）

```javascript
const config = conservativeConfig;
```

### 激进型配置
适合经验丰富的交易者：
- 宽价格区间（±15%）
- 较多网格（20个）
- 较大投资（$50/格）
- 较高杠杆（20x）
- 较短检查间隔（5秒）

```javascript
const config = aggressiveConfig;
```

### 中性策略配置
适合窄幅震荡市场：
- 窄价格区间（±3%）
- 中等网格（8个）
- 中等投资（$20/格）
- 中等杠杆（10x）
- 中等检查间隔（15秒）

```javascript
const config = neutralConfig;
```

## 风险提示

⚠️ **重要风险提示**

1. **市场风险**
   - 网格策略适合震荡行情，在单边趋势行情中可能亏损
   - 如果价格突破网格区间，可能需要重新设置参数

2. **资金风险**
   - 使用杠杆会放大收益，也会放大亏损
   - 确保账户有足够保证金，避免爆仓

3. **技术风险**
   - 网络延迟可能导致成交价格不理想
   - API限流可能影响订单执行
   - 程序异常可能中断策略运行

4. **操作建议**
   - 建议先用小资金测试策略
   - 定期检查策略运行状态
   - 在重大新闻事件前暂停策略
   - 不要使用全部资金
   - 设置合理的止损

## 常见问题

### Q1: 如何选择合适的网格区间？

**A**: 建议根据历史波动率选择：
- 查看过去30天的价格波动范围
- 选择覆盖 80-90% 价格波动的区间
- 对于BTC，通常可以设置当前价格的 ±10-15%

### Q2: 网格数量如何设置？

**A**: 根据价格区间和预期波动：
- 小区间（5%以内）：5-10个网格
- 中区间（5-15%）：10-15个网格
- 大区间（15%以上）：15-25个网格
- 网格过少：错过交易机会
- 网格过多：频繁交易，手续费高

### Q3: 每格投资多少合适？

**A**: 建议：
- 总投资 = 每格投资 × 网格数量
- 总投资不应超过账户资金的 20-30%
- 每格投资 = 总投资 / 网格数量
- 示例：账户 $1000，总投资 $200，10个网格，每格 $20

### Q4: 策略会一直持有仓位吗？

**A**: 
- 网格策略会在不同价格层级建仓和平仓
- 价格在区间内波动时，会自动开平仓
- 价格离开区间后，可能会有未平仓的持仓
- 建议定期检查并手动管理超出区间的持仓

### Q5: 如何优化策略收益？

**A**: 
1. 选择波动率高的交易对
2. 在震荡行情中使用，避开单边趋势
3. 根据市场变化调整网格参数
4. 控制杠杆，降低风险
5. 定期提取利润

### Q6: 程序崩溃了怎么办？

**A**: 
- 重启程序前，先检查持仓情况
- 使用 `example.js` 查看当前持仓
- 根据需要手动平仓或继续策略
- 建议添加监控和告警机制

### Q7: 如何测试策略？

**A**: 
1. 先用保守型配置测试
2. 设置小额资金（如 $50-100）
3. 运行 24-48 小时观察效果
4. 记录盈亏和交易频率
5. 根据结果优化参数

### Q8: 策略收益如何？

**A**: 
- 收益取决于市场波动和参数设置
- 震荡行情：日收益可能 0.5-2%
- 单边趋势：可能出现亏损
- 长期收益需要根据市场调整策略
- 建议设定合理预期

## 技术支持

如遇到问题，请检查：
1. API密钥是否正确
2. 账户余额是否充足
3. 网络连接是否正常
4. 日志中的错误信息

## 免责声明

本策略仅供学习和研究使用。加密货币交易具有高风险，使用本策略进行交易所产生的任何盈利或亏损，由使用者自行承担。请谨慎投资，不要投入超过您承受能力的资金。

---

**祝交易顺利！🚀**

