# ğŸ›¡ï¸ API é™æµä¸‰é‡é˜²æŠ¤æœºåˆ¶

## æ¦‚è¿°

ä¸ºäº†å®Œç¾è§£å†³ Bumpin API çš„é¢‘ç‡é™åˆ¶ï¼ˆHTTP 429ï¼‰é—®é¢˜ï¼Œç³»ç»Ÿå®ç°äº†**ä¸‰é‡é˜²æŠ¤æœºåˆ¶**ï¼Œç¡®ä¿å¤šç­–ç•¥è¿è¡Œæ—¶ä¸ä¼šè§¦å‘é™æµã€‚

---

## ğŸ¯ ä¸‰é‡é˜²æŠ¤æœºåˆ¶

### ç¬¬ä¸€å±‚ï¼šç­–ç•¥å¯åŠ¨å»¶è¿Ÿ

**ä¿æŠ¤ç›®æ ‡**ï¼šé¿å…å¯åŠ¨æ—¶çš„è´¦æˆ·éªŒè¯è¯·æ±‚é›†ä¸­

```
å¯åŠ¨æµç¨‹ï¼š
[1/2] å¯åŠ¨ btc_conservative...
      getAccountInfo() âœ“
âœ… å¯åŠ¨æˆåŠŸ

â±ï¸  ç­‰å¾… 3 ç§’...

[2/2] å¯åŠ¨ eth_moderate...
      getAccountInfo() âœ“  â† å»¶è¿Ÿ3ç§’
âœ… å¯åŠ¨æˆåŠŸ
```

**ä»£ç ä½ç½®**ï¼š`grid-multi-runner.js`
```javascript
for (let i = 0; i < strategies.length; i++) {
    await startStrategy(strategies[i]);
    if (i < strategies.length - 1) {
        await sleep(3000); // 3ç§’å»¶è¿Ÿ
    }
}
```

---

### ç¬¬äºŒå±‚ï¼šæ£€æŸ¥å‘¨æœŸé”™å¼€

**ä¿æŠ¤ç›®æ ‡**ï¼šé¿å…å®šæœŸä»·æ ¼æ£€æŸ¥åŒæ—¶è§¦å‘

```
æ—¶é—´è½´ï¼ˆ2ä¸ªç­–ç•¥ï¼Œ30ç§’é—´éš”ï¼‰ï¼š
0ç§’   [BTCâœ“] â†ç«‹å³å¼€å§‹
15ç§’         [ETHâœ“] â†å»¶è¿Ÿ15ç§’å¼€å§‹ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
30ç§’  [BTCâœ“]
45ç§’         [ETHâœ“]
60ç§’  [BTCâœ“]
75ç§’         [ETHâœ“]

âœ… å®Œç¾é”™å¼€ï¼ŒæŒç»­æœ‰æ•ˆ
```

**ä»£ç ä½ç½®**ï¼š`grid-multi-runner.js` + `grid-trading-strategy.js`
```javascript
// è®¡ç®—åˆå§‹å»¶è¿Ÿ
const initialDelay = (checkInterval / totalStrategies) * strategyIndex;

// ç­–ç•¥å¯åŠ¨æ—¶åº”ç”¨å»¶è¿Ÿ
async start(initialDelay) {
    if (initialDelay > 0) {
        await sleep(initialDelay);
    }
    await checkAndTrade();
    setInterval(...);
}
```

---

### ç¬¬ä¸‰å±‚ï¼šå…¨å±€APIèŠ‚æµ â­ æœ€å¼ºé˜²æŠ¤

**ä¿æŠ¤ç›®æ ‡**ï¼šå¼ºåˆ¶æ‰€æœ‰APIè¯·æ±‚é—´éš”è‡³å°‘2ç§’

```
å®é™…æ‰§è¡Œæ—¶é—´è½´ï¼š
0.0ç§’ - BTC: getAccountInfo() âœ“
2.0ç§’ - BTC: getCurrentPrice() âœ“  â† å¼ºåˆ¶ç­‰å¾…2ç§’
5.0ç§’ - ETH: getAccountInfo() âœ“   â† ç­–ç•¥å¯åŠ¨å»¶è¿Ÿ3ç§’
7.0ç§’ - ETH: getCurrentPrice() âœ“  â† å†ç­‰å¾…2ç§’

âœ… æ¯ä¸ªAPIè¯·æ±‚é—´éš” â‰¥ 2ç§’
```

**ä»£ç ä½ç½®**ï¼š`grid-trading-strategy.js`
```javascript
// å…¨å±€èŠ‚æµå™¨ï¼ˆæ‰€æœ‰ç­–ç•¥å…±äº«ï¼‰
class APIThrottler {
    constructor(minInterval = 2000) {
        this.minInterval = 2000;
        this.lastRequestTime = 0;
    }

    async throttle() {
        const elapsed = Date.now() - this.lastRequestTime;
        if (elapsed < this.minInterval) {
            await sleep(this.minInterval - elapsed);
        }
        this.lastRequestTime = Date.now();
    }
}

const globalThrottler = new APIThrottler(2000);

// æ¯ä¸ªAPIè°ƒç”¨å‰å¼ºåˆ¶èŠ‚æµ
async getCurrentPrice() {
    await globalThrottler.throttle(); // ç¡®ä¿é—´éš”2ç§’
    return await this.api.getPrice(this.symbol);
}
```

---

## ğŸ“Š é˜²æŠ¤æ•ˆæœå¯¹æ¯”

### âŒ æ— é˜²æŠ¤ï¼ˆé¢‘ç¹429é”™è¯¯ï¼‰

```
APIè¯·æ±‚æ—¶é—´è½´ï¼š
0.0ç§’ - BTC: getAccountInfo()
0.1ç§’ - BTC: getCurrentPrice()  â† é—´éš”0.1ç§’
3.0ç§’ - ETH: getAccountInfo()
3.1ç§’ - ETH: getCurrentPrice()  â† HTTP 429é”™è¯¯ï¼

å³°å€¼ï¼š4ä¸ªè¯·æ±‚/3.1ç§’ = 1.29 QPS
ç»“æœï¼šâŒ é¢‘ç¹è§¦å‘é™æµ
```

### âœ… ä¸‰é‡é˜²æŠ¤ï¼ˆå®Œå…¨æ— é™æµï¼‰

```
APIè¯·æ±‚æ—¶é—´è½´ï¼š
0.0ç§’ - BTC: getAccountInfo()
2.0ç§’ - BTC: getCurrentPrice()  â† èŠ‚æµå™¨å»¶è¿Ÿ2ç§’
5.0ç§’ - ETH: getAccountInfo()   â† å¯åŠ¨å»¶è¿Ÿ3ç§’
7.0ç§’ - ETH: getCurrentPrice()  â† èŠ‚æµå™¨å†å»¶è¿Ÿ2ç§’

å³°å€¼ï¼š4ä¸ªè¯·æ±‚/7ç§’ = 0.57 QPS
ç»“æœï¼šâœ… å®Œå…¨æ— é™æµ
```

---

## ğŸ” å·¥ä½œæµç¨‹è¯¦è§£

### å¯åŠ¨2ä¸ªç­–ç•¥çš„å®Œæ•´æµç¨‹

```
ç”¨æˆ·å‘½ä»¤ï¼š
$ node grid-multi-runner.js btc_conservative eth_moderate

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬ä¸€å±‚é˜²æŠ¤ï¼šç­–ç•¥å¯åŠ¨å»¶è¿Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[0.0ç§’] [1/2] å¯åŠ¨ btc_conservative...
         â†“
[0.0ç§’] getAccountInfo() â†’ èŠ‚æµå™¨ï¼šå…è®¸ï¼ˆé¦–æ¬¡ï¼‰
         â†“
[2.0ç§’] ç­–ç•¥å¯åŠ¨æ—¶ getCurrentPrice() â†’ èŠ‚æµå™¨ï¼šç­‰å¾…2ç§’
         â†“
[2.0ç§’] âœ… btc_conservative å¯åŠ¨æˆåŠŸ
         â†“
[2.0ç§’] â±ï¸  ç­‰å¾… 3 ç§’... â† ç¬¬ä¸€å±‚é˜²æŠ¤
         â†“
[5.0ç§’] [2/2] å¯åŠ¨ eth_moderate...
         â†“
[5.0ç§’] getAccountInfo() â†’ èŠ‚æµå™¨ï¼šå…è®¸ï¼ˆè·ä¸Šæ¬¡3ç§’ï¼‰
         â†“
[7.0ç§’] ç­–ç•¥å¯åŠ¨æ—¶ getCurrentPrice() â†’ èŠ‚æµå™¨ï¼šç­‰å¾…2ç§’
         â†“
[7.0ç§’] â±ï¸  åˆå§‹å»¶è¿Ÿ: 15ç§’ â† ç¬¬äºŒå±‚é˜²æŠ¤
         â†“
[22.0ç§’] ETHç­–ç•¥é¦–æ¬¡æ£€æŸ¥ getCurrentPrice()
          â†“
[22.0ç§’] âœ… å…¨éƒ¨å¯åŠ¨æˆåŠŸ

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ç¬¬äºŒå±‚+ç¬¬ä¸‰å±‚é˜²æŠ¤ï¼šè¿è¡Œä¸­çš„æ£€æŸ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ—¶é—´è½´ï¼š
2ç§’   [BTCâœ“] é¦–æ¬¡æ£€æŸ¥
22ç§’       [ETHâœ“] é¦–æ¬¡æ£€æŸ¥ï¼ˆå»¶è¿Ÿ15ç§’åï¼‰â† ç¬¬äºŒå±‚
32ç§’  [BTCâœ“] å®šæœŸæ£€æŸ¥
52ç§’       [ETHâœ“] å®šæœŸæ£€æŸ¥ï¼ˆæŒç»­é”™å¼€ï¼‰
62ç§’  [BTCâœ“] å®šæœŸæ£€æŸ¥
82ç§’       [ETHâœ“] å®šæœŸæ£€æŸ¥

æ¯æ¬¡æ£€æŸ¥å‰éƒ½ä¼šç»è¿‡èŠ‚æµå™¨æ£€æŸ¥ â† ç¬¬ä¸‰å±‚
âœ… åŒä¿é™©ï¼Œç»å¯¹ä¸ä¼šåŒæ—¶è¯·æ±‚
```

---

## ğŸ“‹ åº”ç”¨èŒƒå›´

### å·²åº”ç”¨å…¨å±€èŠ‚æµçš„API

| APIæ–¹æ³• | èŠ‚æµä¿æŠ¤ | åŸå›  |
|---------|---------|------|
| `getAccountInfo()` | âœ… 2ç§’ | æŸ¥è¯¢ç±»APIï¼Œä¸æ€¥éœ€ |
| `getCurrentPrice()` | âœ… 2ç§’ | æŸ¥è¯¢ç±»APIï¼Œä¸æ€¥éœ€ |
| `getCurrentPositions()` | âœ… 2ç§’ | æŸ¥è¯¢ç±»APIï¼Œä¸æ€¥éœ€ |

### æœªåº”ç”¨èŠ‚æµçš„API

| APIæ–¹æ³• | èŠ‚æµä¿æŠ¤ | åŸå›  |
|---------|---------|------|
| `executeBuyOrder()` | âŒ æ—  | äº¤æ˜“APIï¼Œéœ€è¦åŠæ—¶æ‰§è¡Œ |
| `executeSellOrder()` | âŒ æ—  | äº¤æ˜“APIï¼Œéœ€è¦åŠæ—¶æ‰§è¡Œ |

**è¯´æ˜**ï¼šäº¤æ˜“è®¢å•APIä¸åº”ç”¨èŠ‚æµï¼Œç¡®ä¿ä»·æ ¼è§¦å‘æ—¶èƒ½ç«‹å³ä¸‹å•ã€‚

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### æ¨èé…ç½®ï¼ˆ2-3ä¸ªç­–ç•¥ï¼‰

```json
{
  "btc_conservative": {
    "checkInterval": 30000  // 30ç§’
  },
  "eth_moderate": {
    "checkInterval": 30000  // 30ç§’
  }
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- å¯åŠ¨æ—¶é—´ï¼šçº¦5-8ç§’
- APIè¯·æ±‚ï¼šæ¯15ç§’1æ¬¡ï¼ˆ2ä¸ªç­–ç•¥é”™å¼€ï¼‰
- èŠ‚æµè§¦å‘ï¼šå¶å°”ï¼ˆæ­£å¸¸ç°è±¡ï¼‰
- é™æµé”™è¯¯ï¼š0æ¬¡

---

### 4ä¸ªä»¥ä¸Šç­–ç•¥

```json
{
  "checkInterval": 40000  // å»ºè®®å¢åŠ åˆ°40ç§’
}
```

**é¢„æœŸæ•ˆæœ**ï¼š
- å¯åŠ¨æ—¶é—´ï¼šçº¦12-15ç§’
- APIè¯·æ±‚ï¼šæ¯10ç§’1æ¬¡ï¼ˆ4ä¸ªç­–ç•¥é”™å¼€ï¼‰
- èŠ‚æµè§¦å‘ï¼šé¢‘ç¹ï¼ˆæ­£å¸¸ç°è±¡ï¼‰
- é™æµé”™è¯¯ï¼š0æ¬¡

---

## ğŸ¯ æ—¥å¿—è¯†åˆ«

### æ­£å¸¸è¿è¡Œæ—¥å¿—

```
â±ï¸  APIèŠ‚æµï¼šç­‰å¾… 1500msï¼ˆé¿å…è¯·æ±‚è¿‡å¿«ï¼‰  â† ç¬¬ä¸‰å±‚é˜²æŠ¤å·¥ä½œä¸­
âœ… è¯·æ±‚æˆåŠŸ

â±ï¸  åˆå§‹å»¶è¿Ÿ: 15ç§’ï¼ˆé”™å¼€æ£€æŸ¥å‘¨æœŸï¼‰        â† ç¬¬äºŒå±‚é˜²æŠ¤å·¥ä½œä¸­

â±ï¸  ç­‰å¾… 3 ç§’åå¯åŠ¨ä¸‹ä¸€ä¸ªç­–ç•¥...          â† ç¬¬ä¸€å±‚é˜²æŠ¤å·¥ä½œä¸­
```

### å¼‚å¸¸æ—¥å¿—ï¼ˆéœ€è¦å…³æ³¨ï¼‰

```
â±ï¸  APIé™æµ (429)ï¼Œç­‰å¾… 2000ms åé‡è¯•...   â† è§¦å‘é‡è¯•æœºåˆ¶ï¼ˆç½•è§ï¼‰

âŒ è·å–ä»·æ ¼å¤±è´¥: RATE_LIMITED              â† ä¸¥é‡é—®é¢˜ï¼ˆä¸åº”å‡ºç°ï¼‰
```

---

## ğŸ“Š æ€§èƒ½å½±å“

### å¯åŠ¨æ—¶é—´

| ç­–ç•¥æ•° | æ— é˜²æŠ¤ | æœ‰é˜²æŠ¤ | å¢åŠ æ—¶é—´ |
|--------|--------|--------|---------|
| 1ä¸ª | 1ç§’ | 2-3ç§’ | +1-2ç§’ |
| 2ä¸ª | 2ç§’ | 5-8ç§’ | +3-6ç§’ |
| 3ä¸ª | 3ç§’ | 8-12ç§’ | +5-9ç§’ |
| 4ä¸ª | 4ç§’ | 12-16ç§’ | +8-12ç§’ |

**è¯„ä»·**ï¼šå¯åŠ¨ç¨æ…¢ï¼Œä½†æ¢æ¥çš„æ˜¯**é›¶é™æµã€ç¨³å®šè¿è¡Œ**ã€‚

### è¿è¡Œå¼€é”€

- CPUï¼šå‡ ä¹æ— å½±å“ï¼ˆä»…sleepç­‰å¾…ï¼‰
- å†…å­˜ï¼š+1KBï¼ˆèŠ‚æµå™¨å¯¹è±¡ï¼‰
- ç½‘ç»œï¼šæ— å½±å“ï¼ˆå®é™…è¯·æ±‚æ¬¡æ•°ä¸å˜ï¼‰

---

## âœ… éªŒè¯æ–¹æ³•

### 1. è§‚å¯Ÿå¯åŠ¨æ—¥å¿—

```bash
$ node grid-multi-runner.js btc_conservative eth_moderate

# åº”è¯¥çœ‹åˆ°ï¼š
â±ï¸  APIé™æµä¿æŠ¤:
   âœ“ ç­–ç•¥ä¾æ¬¡å¯åŠ¨ï¼ˆé—´éš”3ç§’ï¼‰           â† ç¬¬ä¸€å±‚
   âœ“ æ£€æŸ¥å‘¨æœŸè‡ªåŠ¨é”™å¼€ï¼ˆé¿å…åŒæ—¶è¯·æ±‚ï¼‰   â† ç¬¬äºŒå±‚

â±ï¸  APIèŠ‚æµï¼šç­‰å¾… Xmsï¼ˆé¿å…è¯·æ±‚è¿‡å¿«ï¼‰  â† ç¬¬ä¸‰å±‚

âœ… æˆåŠŸå¯åŠ¨ 2/2 ä¸ªç­–ç•¥
```

### 2. ç›‘æ§è¿è¡Œæ—¥å¿—

```bash
# åº”è¯¥çœ‹åˆ°æ£€æŸ¥å‘¨æœŸé”™å¼€
[00:00] BTCç­–ç•¥ - æ£€æŸ¥ âœ“
[00:15] ETHç­–ç•¥ - æ£€æŸ¥ âœ“  â† é”™å¼€15ç§’
[00:30] BTCç­–ç•¥ - æ£€æŸ¥ âœ“
[00:45] ETHç­–ç•¥ - æ£€æŸ¥ âœ“
```

### 3. æ£€æŸ¥é”™è¯¯æ—¥å¿—

```bash
# ä¸åº”è¯¥çœ‹åˆ°ï¼š
âŒ HTTP 429 é”™è¯¯
âŒ RATE_LIMITED é”™è¯¯
```

---

## ğŸ“ æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶é‡åˆ°429é”™è¯¯

1. **æ£€æŸ¥checkIntervalæ˜¯å¦è¿‡å°**
   ```json
   {
     "checkInterval": 10000  â† å¦‚æœæ˜¯è¿™ä¸ªï¼Œæ”¹ä¸º30000
   }
   ```

2. **æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç¨‹åºåœ¨ä½¿ç”¨åŒä¸€API**
   - å…³é—­å…¶ä»–äº¤æ˜“ç¨‹åº
   - ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹è¿è¡Œ

3. **å¢åŠ èŠ‚æµé—´éš”**ï¼ˆæç«¯æƒ…å†µï¼‰
   ```javascript
   // ä¿®æ”¹ grid-trading-strategy.js
   const globalThrottler = new APIThrottler(3000); // æ”¹ä¸º3ç§’
   ```

---

## ğŸ‰ æ€»ç»“

ä¸‰é‡é˜²æŠ¤æœºåˆ¶ç¡®ä¿ï¼š

1. âœ… **å¯åŠ¨é˜¶æ®µ**ï¼šç­–ç•¥é—´éš”3ç§’å¯åŠ¨
2. âœ… **è¿è¡Œé˜¶æ®µ**ï¼šæ£€æŸ¥å‘¨æœŸè‡ªåŠ¨é”™å¼€
3. âœ… **å…¨ç¨‹ä¿æŠ¤**ï¼šæ‰€æœ‰APIè¯·æ±‚é—´éš”â‰¥2ç§’
4. âœ… **ç»“æœ**ï¼šå®Œå…¨é¿å…HTTP 429é™æµé”™è¯¯

**ç°åœ¨ä½ å¯ä»¥æ”¾å¿ƒåœ°åŒæ—¶è¿è¡Œå¤šä¸ªç­–ç•¥ï¼** ğŸš€âœ¨

